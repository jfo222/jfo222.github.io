import e from"./config.json"with{type:"json"};(()=>{let t,n,o,r,a,s,[i,c,l,d,u]=[0,0,0,0,0],m="char";let f=new AudioContext,[h,p]=[document.body,document.head],v=["arrow","char"],[g,w]=[8,5];function E(e,t=h){return t.querySelector(e)}function M(e,t){let n=document.createElement(e);return t&&t.append(n),n}function x(e,t=1){let n=M("div",h);if(n.className="error",n.textContent=`[${e}]`,t)throw new Error(e)}function N(t){if(!e.sound)return;let n=Object.assign({gain:.2,ramp:1,start:0,wave:"sine"},t),o=new OscillatorNode(f,{frequency:n.freq,type:n.wave}),r=new GainNode(f,{gain:n.gain});r.gain.setValueAtTime(n.gain,f.currentTime+n.start+.01),n.ramp&&r.gain.exponentialRampToValueAtTime(1e-4,f.currentTime+n.stop),o.connect(r).connect(f.destination),o.start(f.currentTime+n.start),o.stop(f.currentTime+n.stop)}function y(){N({freq:540,stop:.1})}function $(){let[e,t]=[0,13];for(;t<68;)N({freq:1600,start:e/100,stop:t/100}),e+=9,t+=9}function C(e,t,n){let o;n&&(e.textContent=n),e.addEventListener("pointerdown",()=>{y(),e.classList.add("active"),o=1,document.addEventListener("pointerup",()=>{e.classList.remove("active"),o=0},{once:1})}),e.addEventListener("pointerup",()=>{o&&(e.classList.remove("active"),o=0,t(e))})}function L(){[...h.childNodes].forEach(e=>e.remove())}function k(){let t=E("#tmpl-1",p).content.cloneNode(1);function n(t){return t&&(e.sound=!e.sound),e.sound?"ðŸ”Š":"ðŸ”‡"}function a(e){return e&&(m=v.find(e=>m!==e)),"char"===m?"!":"!!"}function s(e){r=e.id,T()}L(),C(E(".help",t),e=>{e.firstChild.nodeValue?(e.firstChild.replaceWith(M("ol")),Object.values(o.ol).forEach(t=>{M("li",e.firstChild).textContent=t})):e.textContent="?"},"?"),C(E(".speaker",t),e=>{e.textContent=n(1)},n()),C(E(".alt",t),e=>{e.textContent=a(1)},a()),[...E(".menu",t).children].forEach((e,t)=>{C(e,s,o.menu[t])}),C(E(".source",t),()=>{open(E(".source").dataset.href,"_blank")}),C(E(".screen",t),()=>{document.fullscreenElement?document.exitFullscreen():h.parentNode.requestFullscreen()}),document.fullscreenEnabled||(E(".screen",t).className="none"),[l,i]=[0,0],h.append(t)}function T(){let t=E("#tmpl-2",p).content.cloneNode(1),d=E(".circle",t);function u(t){return t?(c<e.limitMax?c+=1:c=e.limitMin,[l,i]=[0,0],E(".result")?.remove()):a===r&&s===m||([c,a,s]=[e.limitMin,r,m]),`${o.ctrl[0]} ${c}`}L(),C(E(".x",t),e=>{e.textContent=u(1)},u()),C(E(".esc",t),k,o.ctrl[1]),C(d,b),/^(alt|und)/m.test(e.reverse[m])&&(n?.length||(e.reverse[m]=e.reverse[m]?void 0:"alternate"),d.className+=" marker"+(e.reverse[m]?" reverse":"")),h.append(t)}function q(){let[n,o]=[1,0];let r=innerWidth>innerHeight?g:w,a=Array.from({length:w*g},()=>(o===r&&(n+=1,o=0),o+=1,`${n}/${o}`));function s(e){let n=M("div");n.className=m,n.style.gridArea=a.splice(Math.floor(Math.random()*a.length),1)[0],n.style.setProperty("--stm",e),t.push(n)}t=[],{arrow(){let t=Math.round(360/c*100)/100;let n,[o,r]=[t,0];for(e.randomize[m]?(o-=4,n=()=>Math.round(o-Math.floor(Math.random()*(t-7)))):n=()=>Math.round(o-t/2);r<c;)s(`${n()}deg`),o+=t,r+=1},char(){let[t,n]="alpha"===e.alphanumeric?[65,26]:e.limitMax<10?[49,9]:[48,10],o=[...new Array(e.limitMax<n?e.limitMax:n).keys()].map(e=>t+e);if(c>n&&(c=n),e.randomize[m])for(;o.length>c;)o.splice(Math.floor(Math.random()*o.length),1);else o.length=c;o.forEach(e=>s(JSON.stringify(String.fromCodePoint(e))))}}[m](),e.reverse[m]&&t.reverse()}function A(e,o=e.target.closest(".mask")){o&&(o.className="",t.indexOf(o)===n.shift()&&n.length?y():(h.removeEventListener("pointerdown",A),O(o)))}function j(){function n(){t.forEach(e=>{e.className="mask"}),u=performance.now(),h.addEventListener("pointerdown",A),i+=1}h.append(...t),d=performance.now(),e.time[r]?setTimeout(n,e.time[r]):h.addEventListener("pointerdown",function e(t){let o=t.target.closest("div");o&&(h.removeEventListener("pointerdown",e),n(),A(t,o))})}function b(){L(),n=[...new Array(c).keys()],h.className="task"+(e.altMask[m]?" alt-mask":""),q(),j()}function O(e){let t=E("#tmpl-3",p).content.cloneNode(1),r=[];let a=0;n.length?(a=800,e.classList.add("wrong",m),r.push(`- ${o.res[0]} -`),N({freq:140,gain:.18,ramp:0,stop:.6,wave:"sawtooth"})):(l+=1,r.push(`- ${o.res[1]} -`),$()),r.push(`${Math.round(l/i*100)}% (${l} / ${i})`,`${Math.round((u-d)/10)/100}${o.res[2]}`),r.forEach((e,n)=>{t.children[0].children[n].textContent=e}),setTimeout(()=>{h.className="",T(),h.append(t)},a)}document.addEventListener("touchstart",e=>{e.preventDefault()},{passive:0}),(async e=>{let t=await fetch(e);t.ok||x("No language file"),o=await t.json()})(`./lang/${e.lang}.json`).then(()=>k())})();

